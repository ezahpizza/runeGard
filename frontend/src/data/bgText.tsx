const bgText=`#include<linux/kernel.h>#include<linux/slab.h>#include<linux/string.h>#include<generated/utsrelease.h>#include<linux/mm.h>#include<asm/console.h>#include<asm/hwrpb.h>#include<asm/io.h>#include<linux/stdarg.h>#include"ksize.h"externunsignedlongswitch_to_osf_pal(unsignedlongnr,structpcb_struct*pcb_va,structpcb_struct*pcb_pa,unsignedlong*vptb);externvoidmove_stack(unsignedlongnew_stack);structhwrpb_struct*hwrpb=INIT_HWRPB;staticstructpcb_structpcb_va[1];/**Findaphysicaladdressofavirtualobject..**Thisiseasyusingthevirtualpagetableaddress.*/staticinlinevoid*find_pa(unsignedlong*vptb,void*ptr){unsignedlongaddress=(unsignedlong)ptr;unsignedlongresult;result=vptb[address>>13];result>>=32;result<<=13;result|=address&0x1fff;return(void*)result;}/**ThisfunctionmovesintoOSF/1pal-code,andhasatemporary*PCBforthat.ThekernelpropershouldreplacethisPCBwith*therealoneassoonaspossible.**Thepagetablemuckeryinheredependsonthefactthattheboot*codehastheL1pagetableidentity-mapitselfinthesecondPTE*intheL1pagetable.ThustheL1-pageisvirtuallyaddressable*itself(throughthreelevels)atvirtualaddress0x200802000.*/#defineVPTB((unsignedlong*)0x200000000)#defineL1((unsignedlong*)0x200802000)voidpal_init(void){unsignedlongi,rev;structpercpu_struct*percpu;structpcb_struct*pcb_pa;/*CreatethedummyPCB.*/pcb_va->ksp=0;pcb_va->usp=0;pcb_va->ptbr=L1[1]>>32;pcb_va->asn=0;pcb_va->pcc=0;pcb_va->unique=0;pcb_va->flags=1;pcb_va->res1=0;pcb_va->res2=0;pcb_pa=find_pa(VPTB,pcb_va);/**a0=2(OSF)*a1=returnaddress,butwegivetheasmthevaddrofthePCB*a2=physicaladdrofPCB*a3=newvirtualpagetablepointer*a4=KSP(buttheasmsetsit)*/srm_printk("SwitchingtoOSFPAL-code..");i=switch_to_osf_pal(2,pcb_va,pcb_pa,VPTB);if(i){srm_printk("failed,code%ld",i);__halt();}percpu=(structpercpu_struct*)(INIT_HWRPB->processor_offset+(unsignedlong)INIT_HWRPB);rev=percpu->pal_revision=percpu->palcode_avail[2];srm_printk("Ok(rev%lx)",rev);tbia();/*doitdirectlyincaseweareSMP*/}staticinlinevoidload(unsignedlongdst,unsignedlongsrc,unsignedlongcount){memcpy((void*)dst,(void*)src,count);}/**Startthekernel.*/staticinlinevoidrunkernel(void){__asm____volatile__("bis%0,%0,$27""jmp($27)":/*nooutputs:itdoesn'tevenreturn*/:"r"(START_ADDR));}externchar_end;#defineKERNEL_ORIGIN((((unsignedlong)&_end)+511)&~511)voidstart_kernel(void){/**Notethatthiscruftystuffwithstaticandenvval*andenvbufisbecause:**1.Frequently,thestackisshort,andwedon'twanttooverrun;*2.Frequentlythestackiswherewearegoingtocopythekernelto;*3.AcertainSRMconsolerequiredtheGET_ENVoutputtostack.*???AcommentintheabootsourcesindicatesthattheGET_ENV*destinationmustbequadwordaligned.Mightthisexplainthe*behaviour,ratherthanrequiringoutputtothestack,which*seemsratherfar-fetched.*/staticlongnbytes;staticcharenvval[256]__attribute__((aligned(8)));staticunsignedlonginitrd_start;srm_printk("Linux/AXPbootploaderforLinux"UTS_RELEASE"");if(INIT_HWRPB->pagesize!=8192){srm_printk("Expected8kBpages,got%ldkB",INIT_HWRPB->pagesize>>10);return;}if(INIT_HWRPB->vptb!=(unsignedlong)VPTB){srm_printk("Expectedvptbat%p,got%p",VPTB,(void*)INIT_HWRPB->vptb);return;}pal_init();/*Theinitrdmustbepage-aligned.Seebelowforthecauseofthemagicnumber5.*/initrd_start=((START_ADDR+5*KERNEL_SIZE+PAGE_SIZE)|(PAGE_SIZE-1))+1;#ifdefINITRD_IMAGE_SIZEsrm_printk("Initrdpositionedat%#lx",initrd_start);#endif/**Movethestacktoasafeplacetoensureitwon'tbe*overwrittenbykernelimage.*/move_stack(initrd_start-PAGE_SIZE);nbytes=callback_getenv(ENV_BOOTED_OSFLAGS,envval,sizeof(envval));if(nbytes<0||nbytes>=sizeof(envval)){nbytes=0;}envval[nbytes]='0';srm_printk("Loadingthekernel...'%s'",envval);/*NOTE:*no*callbacksorprintoutsfromhereonout!!!*//*Thisisahack,assomeconsolesseemtogetvirtual20000000(ie*wheretheSRMconsoleputsthekernelbootpimage)memory*overlappingphysicalmemorywherethekernelwantstobeput,*whichcausesrealproblemswhenattemptingtocopytheformerto*thelatter...:-(**So,wefirstmovethekernelvirtual-to-physicalwayabovewhere*wephysicallywantthekerneltoendup,thencopyitfromthere*toitsfinalrestingplace...;-}**Sigh...*/#ifdefINITRD_IMAGE_SIZEload(initrd_start,KERNEL_ORIGIN+KERNEL_SIZE,INITRD_IMAGE_SIZE);#endifload(START_ADDR+(4*KERNEL_SIZE),KERNEL_ORIGIN,KERNEL_SIZE);load(START_ADDR,START_ADDR+(4*KERNEL_SIZE),KERNEL_SIZE);memset((char*)ZERO_PGE,0,PAGE_SIZE);strcpy((char*)ZERO_PGE,envval);#ifdefINITRD_IMAGE_SIZE((long*)(ZERO_PGE+256))[0]=initrd_start;((long*)(ZERO_PGE+256))[1]=INITRD_IMAGE_SIZE;#endifrunkernel();}//SPDX-License-Identifier:GPL-2.0/**arch/alpha/boot/bootpz.c**Copyright(C)1997JayEstabrook**ThisfileisusedforcreatingacompressedBOOTPfileforthe*Linux/AXPkernel**basedsignificantlyonthearch/alpha/boot/main.cofLinusTorvalds*andthedecompressioncodefromMILO.*/#include<linux/kernel.h>#include<linux/slab.h>#include<linux/string.h>#include<generated/utsrelease.h>#include<linux/mm.h>#include<asm/console.h>#include<asm/hwrpb.h>#include<asm/io.h>#include<linux/stdarg.h>#include"kzsize.h"/*FIXMEFIXMEFIXME*/#defineMALLOC_AREA_SIZE0x200000/*2MBfornow*//*FIXMEFIXMEFIXME*//*WARNINGNOTEItisverypossiblethatturningonadditionalmessagesmaycausekernelimagecorruptionduetostackusagetodotheprinting.*/#undefDEBUG_CHECK_RANGE#undefDEBUG_ADDRESSES#undefDEBUG_LAST_STEPSexternunsignedlongswitch_to_osf_pal(unsignedlongnr,structpcb_struct*pcb_va,structpcb_struct*pcb_pa,unsignedlong*vptb);externintdecompress_kernel(void*destination,void*source,size_tksize,size_tkzsize);externvoidmove_stack(unsignedlongnew_stack);structhwrpb_struct*hwrpb=INIT_HWRPB;staticstructpcb_structpcb_va[1];/**Findaphysicaladdressofavirtualobject..**Thisiseasyusingthevirtualpagetableaddress.*/#defineVPTB((unsignedlong*)0x200000000)staticinlineunsignedlongfind_pa(unsignedlongaddress){unsignedlongresult;result=VPTB[address>>13];result>>=32;result<<=13;result|=address&0x1fff;returnresult;}intcheck_range(unsignedlongvstart,unsignedlongvend,unsignedlongkstart,unsignedlongkend){unsignedlongvaddr,kaddr;#ifdefDEBUG_CHECK_RANGEsrm_printk("check_range:V[0x%lx:0x%lx]K[0x%lx:0x%lx]",vstart,vend,kstart,kend);#endif/*dosomerangecheckingfordetectinganoverlap...*/for(vaddr=vstart;vaddr<=vend;vaddr+=PAGE_SIZE){kaddr=(find_pa(vaddr)|PAGE_OFFSET);if(kaddr>=kstart&&kaddr<=kend){#ifdefDEBUG_CHECK_RANGEsrm_printk("OVERLAP:vaddr0x%lxkaddr0x%lx""[0x%lx:0x%lx]",vaddr,kaddr,kstart,kend);#endifreturn1;}}return0;}/**ThisfunctionmovesintoOSF/1pal-code,andhasatemporary*PCBforthat.ThekernelpropershouldreplacethisPCBwith*therealoneassoonaspossible.**Thepagetablemuckeryinheredependsonthefactthattheboot*codehastheL1pagetableidentity-mapitselfinthesecondPTE*intheL1pagetable.ThustheL1-pageisvirtuallyaddressable*itself(throughthreelevels)atvirtualaddress0x200802000.*/#defineL1((unsignedlong*)0x200802000)voidpal_init(void){unsignedlongi,rev;structpercpu_struct*percpu;structpcb_struct*pcb_pa;/*CreatethedummyPCB.*/pcb_va->ksp=0;pcb_va->usp=0;pcb_va->ptbr=L1[1]>>32;pcb_va->asn=0;pcb_va->pcc=0;pcb_va->unique=0;pcb_va->flags=1;pcb_va->res1=0;pcb_va->res2=0;pcb_pa=(structpcb_struct*)find_pa((unsignedlong)pcb_va);/**a0=2(OSF)*a1=returnaddress,butwegivetheasmthevaddrofthePCB*a2=physicaladdrofPCB*a3=newvirtualpagetablepointer*a4=KSP(buttheasmsetsit)*/srm_printk("SwitchingtoOSFPAL-code...");i=switch_to_osf_pal(2,pcb_va,pcb_pa,VPTB);if(i){srm_printk("failed,code%ld",i);__halt();}percpu=(structpercpu_struct*)(INIT_HWRPB->processor_offset+(unsignedlong)INIT_HWRPB);rev=percpu->pal_revision=percpu->palcode_avail[2];srm_printk("OK(rev%lx)",rev);tbia();/*doitdirectlyincaseweareSMP*/}/**Startthekernel.*/staticinlinevoidrunkernel(void){__asm____volatile__("bis%0,%0,$27""jmp($27)":/*nooutputs:itdoesn'tevenreturn*/:"r"(START_ADDR));}/*MustrecordtheSP(itisvirtual)onentry,sowecanmakesurenottooverwriteitduringmovementordecompression.*/unsignedlongSP_on_entry;/*CalculatethekernelimageaddressbasedontheendoftheBOOTPbootstrapper(iethisprogram).*/externchar_end;#defineKERNEL_ORIGIN((((unsignedlong)&_end)+511)&~511)/*Roundaddresstonexthigherpageboundary.*/#defineNEXT_PAGE(a)(((a)|(PAGE_SIZE-1))+1)#ifdefINITRD_IMAGE_SIZE#defineREAL_INITRD_SIZEINITRD_IMAGE_SIZE#else#defineREAL_INITRD_SIZE0#endif/*Definesfrominclude/asm-alpha/system.hBOOT_ADDRVirtualaddressatwhichtheconsolesloadstheBOOTPimage.KERNEL_STARTKSEGaddressatwhichthekernelisbuilttorun,whichincludessomeinitialdatapagesbeforethecode.START_ADDRKSEGaddressoftheentrypointofkernelcode. *WARNINGNOTEItisverypossiblethatturningonadditionalmessagesmaycausekernelimagecorruptionduetostackusagetodotheprinting.*/#undefDEBUG_CHECK_RANGE#undefDEBUG_ADDRESSES#undefDEBUG_LAST_STEPSexternunsignedlongswitch_to_osf_pal(unsignedlongnr,structpcb_struct*pcb_va,structpcb_struct*pcb_pa,unsignedlong*vptb);externintdecompress_kernel(void*destination,void*source,size_tksize,size_tkzsize);externvoidmove_stack(unsignedlongnew_stack);structhwrpb_struct*hwrpb=INIT_HWRPB;staticstructpcb_structpcb_va[1];/**Findaphysicaladdressofavirtualobject..**Thisiseasyusingthevirtualpagetableaddress.*/#defineVPTB((unsignedlong*)0x200000000)staticinlineunsignedlongfind_pa(unsignedlongaddress){unsignedlongresult;result=VPTB[address>>13];result>>=32;result<<=13;result|=address&0x1fff;returnresult;}intcheck_range(unsignedlongvstart,unsignedlongvend,unsignedlongkstart,unsignedlongkend){unsignedlongvaddr,kaddr;#ifdefDEBUG_CHECK_RANGEsrm_printk("check_range:V[0x%lx:0x%lx]K[0x%lx:0x%lx]",vstart,vend,kstart,kend);#endif/*dosomerangecheckingfordetectinganoverlap...*/for(vaddr=vstart;vaddr<=vend;vaddr+=PAGE_SIZE){kaddr=(find_pa(vaddr)|PAGE_OFFSET);if(kaddr>=kstart&&kaddr<=kend){#ifdefDEBUG_CHECK_RANGEsrm_printk("OVERLAP:vaddr0x%lxkaddr0x%lx""[0x%lx:0x%lx]",vaddr,kaddr,kstart,kend);#endifreturn1;}}return0;}/**ThisfunctionmovesintoOSF/1pal-code,andhasatemporary*PCBforthat.ThekernelpropershouldreplacethisPCBwith*therealoneassoonaspossible.**Thepagetablemuckeryinheredependsonthefactthattheboot*codehastheL1pagetableidentity-mapitselfinthesecondPTE*intheL1pagetable.ThustheL1-pageisvirtuallyaddressable*itself(throughthreelevels)atvirtualaddress0x200802000.*/#defineL1((unsignedlong*)0x200802000)voidpal_init(void){unsignedlongi,rev;structpercpu_struct*percpu;structpcb_struct*pcb_pa;/*CreatethedummyPCB.*/pcb_va->ksp=0;pcb_va->usp=0;pcb_va->ptbr=L1[1]>>32;pcb_va->asn=0;pcb_va->pcc=0;pcb_va->unique=0;pcb_va->flags=1;pcb_va->res1=0;pcb_va->res2=0;pcb_pa=(structpcb_struct*)find_pa((unsignedlong)pcb_va);/**a0=2(OSF)*a1=returnaddress,butwegivetheasmthevaddrofthePCB*a2=physicaladdrofPCB*a3=newvirtualpagetablepointer*a4=KSP(buttheasmsetsit)*/srm_printk("SwitchingtoOSFPAL-code...");i=switch_to_osf_pal(2,pcb_va,pcb_pa,VPTB);if(i){srm_printk("failed,code%ld",i);__halt();}percpu=(structpercpu_struct*)(INIT_HWRPB->processor_offset+(unsignedlong)INIT_HWRPB);rev=percpu->pal_revision=percpu->palcode_avail[2];srm_printk("OK(rev%lx)",rev);tbia();/*doitdirectlyincaseweareSMP*/}/**Startthekernel.*/staticinlinevoidrunkernel(void){__asm____volatile__("bis%0,%0,$27""jmp($27)":/*nooutputs:itdoesn'tevenreturn*/:"r"(START_ADDR));}/*MustrecordtheSP(itisvirtual)onentry,sowecanmakesurenottooverwriteitduringmovementordecompression.*/unsignedlongSP_on_entry;/*CalculatethekernelimageaddressbasedontheendoftheBOOTPbootstrapper(iethisprogram).*/externchar_end;#defineKERNEL_ORIGIN((((unsignedlong)&_end)+511)&~511)/*Roundaddresstonexthigherpageboundary.*/#defineNEXT_PAGE(a)(((a)|(PAGE_SIZE-1))+1)#ifdefINITRD_IMAGE_SIZE#defineREAL_INITRD_SIZEINITRD_IMAGE_SIZE#else#defineREAL_INITRD_SIZE0#endif/*Definesfrominclude/asm-alpha/system.hBOOT_ADDRVirtualaddressatwhichtheconsolesloadstheBOOTPimage.KERNEL_STARTKSEGaddressatwhichthekernelisbuilttorun,whichincludessomeinitialdatapagesbeforethecode.START_ADDRKSEGaddressoftheentrypointofkernelcode. `

export default bgText;

